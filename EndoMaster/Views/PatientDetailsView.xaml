<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="EndoMaster.Views.PatientDetailsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:EndoMaster.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid Padding="16">
        <Grid.RowDefinitions>
            <!-- górna część: badania + elementy badania + podgląd -->
            <RowDefinition Height="*"/>
            <!-- dolna część: opis badania + przyciski -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <!-- lewa kolumna: pacjent + lista badań -->
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="16"/>
            <!-- prawa część: elementy badania + podgląd -->
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEWA STRONA: pacjent + badania -->
        <StackPanel Grid.Column="0" Grid.Row="0" Spacing="6">
            <Button x:Name="BackBtn"
            Content="← Lista pacjentów"
            HorizontalAlignment="Left"
            Margin="0,0,0,8"
            Click="BackBtn_Click"/>
            
            <TextBlock x:Name="PatientNameText"
                       FontSize="22"
                       FontWeight="SemiBold"/>
            <TextBlock x:Name="PatientPeselText" Opacity="0.8"/>
            <TextBlock x:Name="PatientExtraText" Opacity="0.8"/>

            <TextBlock Text="Badania:"
                       FontWeight="SemiBold"
                       Margin="0,8,0,0"/>

            <ListView x:Name="ExamsList"
                      Height="260"
                      SelectionChanged="ExamsList_SelectionChanged">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Grid.Column="0"
                                       Text="{Binding Date}"
                                       Margin="0,0,8,0"/>
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Label}"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackPanel>

        <!-- PRAWA STRONA: elementy badania + podgląd -->
        <Grid Grid.Column="2" Grid.Row="0">
            <Grid.ColumnDefinitions>
                <!-- lista elementów -->
                <ColumnDefinition Width="2*"/>
                <!-- podgląd -->
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>

            <!-- lista elementów badania + przycisk USUŃ ELEMENT -->
            <StackPanel Grid.Column="0" Spacing="4">
                <TextBlock x:Name="SelectedMediaHeader"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Margin="0,0,0,4"
                           Text="Elementy badania"/>

                <ListView x:Name="MediaList"
                          Height="260"
                          SelectionChanged="MediaList_SelectionChanged"
                          DoubleTapped="MediaList_DoubleTapped">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="80,80,*">
                                <TextBlock Grid.Column="0"
                                           Text="{Binding Kind}"
                                           Margin="0,0,8,0"/>
                                <TextBlock Grid.Column="1"
                                           Text="{Binding Time}"
                                           Margin="0,0,8,0"/>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding FileName}"/>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <Button x:Name="DeleteMediaBtn"
                        Content="Usuń element"
                        Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Click="DeleteMediaBtn_Click"
                        IsEnabled="False"/>
            </StackPanel>

            <!-- PODGLĄD ZDJĘCIA / NAGRANIA -->
            <Grid Grid.Column="1" Margin="12,0,0,0">
                <Border Background="Black">
                    <Grid>
                        <!-- podgląd wideo -->
                        <MediaPlayerElement x:Name="PreviewPlayer"
                                            AreTransportControlsEnabled="False"
                                            Visibility="Collapsed"/>

                        <!-- podgląd zdjęcia -->
                        <Image x:Name="PreviewImage"
                               Stretch="Uniform"
                               Visibility="Collapsed"/>

                        <!-- placeholder, gdy nic nie wybrano -->
                        <TextBlock x:Name="PreviewPlaceholder"
                                   Text="Brak wybranego elementu"
                                   Foreground="White"
                                   Opacity="0.7"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"/>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!-- DÓŁ: opis badania + przyciski -->
        <Grid Grid.Row="1"
              Grid.ColumnSpan="3"
              Margin="0,16,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Row="0"
                       Grid.ColumnSpan="3"
                       Text="Opis badania:"
                       Margin="0,0,0,4"/>

            <TextBox x:Name="ExamDescriptionText"
                     Grid.Row="1"
                     Grid.Column="0"
                     Margin="0,0,16,0"
                     Height="120"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     IsReadOnly="True"/>

            <Button x:Name="EditDescriptionBtn"
                    Grid.Row="1"
                    Grid.Column="1"
                    Content="Edytuj opis"
                    Width="110"
                    Margin="0,0,8,0"
                    Click="EditDescriptionBtn_Click"
                    IsEnabled="False"/>

            <Button x:Name="DeleteExamBtn"
                    Grid.Row="1"
                    Grid.Column="2"
                    Content="Usuń badanie"
                    Width="120"
                    Click="DeleteExamBtn_Click"
                    IsEnabled="False"/>
        </Grid>
    </Grid>
</UserControl>
